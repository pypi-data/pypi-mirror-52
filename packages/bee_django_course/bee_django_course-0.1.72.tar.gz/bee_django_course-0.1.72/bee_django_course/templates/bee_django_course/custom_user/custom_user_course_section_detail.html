{% extends "bee_django_course/user_base.html" %}
{% load bee_django_course_filter %}
{% load bootstrap3 %}
{% block content %}

    <h4>{{ usercoursesection.section.name }} </h4>


    {% for e in usercoursesection.section.sectionvideo_set.all %}
        <div>
            {{ e.video.title }}
            <div class="bg-black">
                <iframe src="{{ e.video.video_id | get_video_src }}" frameborder="0" width="100%"
                        height="100%"></iframe>
            </div>
            {{ e.video.info | default:'' | linebreaks }}
        </div>
    {% endfor %}


    <p>
        {{ usercoursesection.section.info |default:""| safe }}
    </p>
    <hr>

    {% for attach in usercoursesection.section.sectionattach_set.all %}
        <div>
            <span class="text-danger">【教材】</span>
            <a href="{{ attach.file.url }}">
                {{ attach.file_name }}
            </a>
        </div>
    {% endfor %}
    <hr>
    {% if user and user.is_pause %}
    {% else %}
        {% if usercoursesection.section.has_textwork %}
            <h5>文字作业：{{ usercoursesection.section.textwork_info }}</h5>
        {% endif %}

        {% if usercoursesection.section.has_imagework %}
            <h5>图片作业：需要上传{{ usercoursesection.section.image_count_req }}张图片</h5>
        {% endif %}

        {% if usercoursesection.section.has_videowork %}
            <h5>视频作业：需要录制{{ usercoursesection.section.video_length_req }}分钟的作业</h5>
            {% if  request.user == usercoursesection.user_course.user %}
                <a href="{% url 'bee_django_course:custom_user_live_page' request.user.id %}" class="btn btn-info">去练习</a>
            {% endif %}
        {% endif %}
        <hr>
        {% if request.user == usercoursesection.user_course.user %}
            {% if usercoursesection.section.has_imagework or usercoursesection.section.has_textwork %}
                <a href="{% url 'bee_django_course:user_assignment' ucs_id=usercoursesection.id %}"
                   class="btn btn-info">去做作业</a>
            {% endif %}

            {% if usercoursesection.section.has_questionwork %}
                <h5>需要答题</h5>
                {% if usercoursesection.question_passed %}
                    <h5>
                        已通过答题
                    </h5>

                    {% for question in questions %}
                        <div><b>{{ forloop.counter }}. {{ question.question }}</b></div>
                        {% get_user_question_answer question user as records %}
                        我的答案：
                        {% for record in records %}
                            {{ record.answer.option }}
                            {% if not  forloop.last %},{% endif %}
                        {% endfor %}
                    {% endfor %}
                    {% for record in my_questions %}


                    {% endfor %}
                {% else %}
                    <h5>
                        <a href="{% url 'bee_django_course:question_answer' usercoursesection.id %}"
                           class="btn btn-default">去答题</a>
                    </h5>
                {% endif %}
            {% endif %}
        {% endif %}
    {% endif %}

    {% if user and user.is_pause %}

    {% else %}
        <form method="post" action="">
            {% csrf_token %}
            {% bootstrap_form note_form %}
            {% bootstrap_button '提交' %}
        </form>
    {% endif %}
    <hr>
    <ul class="nav nav-tabs" id="section_notes">

        <li class="active"><a href="#other_notes" data-toggle="tab">全部笔记</a></li>
        <li><a href="#my_note" data-toggle="tab">我的笔记</a></li>
    </ul>

    <div class="tab-content">
        <div id="other_notes" class="tab-pane active">
            {% include "bee_django_course/user/section_notes.html" with notes=open_notes %}
        </div>
        <div id="my_note" class="tab-pane">
            {% include "bee_django_course/user/section_notes.html" with notes=my_notes %}
        </div>
    </div>

{% endblock content %}