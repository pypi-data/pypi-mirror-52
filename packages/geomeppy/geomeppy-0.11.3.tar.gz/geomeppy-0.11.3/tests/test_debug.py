import pytest


@pytest.fixture
def shadow_matching():
    shadow_blocks = [
        {
            "name": "PN1001_Bld1001",
            "coordinates": [
                (-83636.50970000029, -100976.35019999929),
                (-83637.73039999977, -100993.7087999992),
                (-83652.75889999978, -100992.65210000053),
                (-83651.5382000003, -100975.29350000061),
                (-83636.50970000029, -100976.35019999929),
            ],
            "height": 21.0,
        }
    ]
    zones = [
        {
            "name": "PN1001_Bld1003 Zone1",
            "coordinates": [
                (-83637.86197158082, -100995.57970000058),
                (-83623.76818996808, -100995.57970000058),
                (-83629.44400000013, -101021.71050000004),
                (-83639.28569999989, -101015.82459999993),
                (-83637.86197158082, -100995.57970000058),
            ],
            "height": 3.0,
            "num_stories": 1,
        },
        {
            "name": "PN1001_Bld1003 Zone2",
            "coordinates": [
                (-83623.76818996808, -100995.57970000058),
                (-83637.86197158082, -100995.57970000058),
                (-83637.73039999977, -100993.7087999992),
                (-83636.55229433342, -100976.95590000041),
                (-83619.72295787116, -100976.95590000041),
                (-83623.76818996808, -100995.57970000058),
            ],
            "height": 3.0,
            "num_stories": 1,
        },
        {
            "name": "PN1001_Bld1003 Zone3",
            "coordinates": [
                (-83614.40199999977, -100952.4587999992),
                (-83616.24896021019, -100960.96199999936),
                (-83635.42752116646, -100960.96199999936),
                (-83635.2890999997, -100958.99369999953),
                (-83634.0064000003, -100940.75280000083),
                (-83614.40199999977, -100952.4587999992),
            ],
            "height": 3.0,
            "num_stories": 1,
        },
        {
            "name": "PN1001_Bld1003 Zone4",
            "coordinates": [
                (-83616.24896021019, -100960.96199999936),
                (-83619.72295787116, -100976.95590000041),
                (-83636.55229433342, -100976.95590000041),
                (-83636.50970000029, -100976.35019999929),
                (-83635.42752116646, -100960.96199999936),
                (-83616.24896021019, -100960.96199999936),
            ],
            "height": 3.0,
            "num_stories": 1,
        },
    ]
    return {"zones": zones, "shadows": shadow_blocks}


def test_shadow_matching(new_idf, shadow_matching):
    for block in shadow_matching["shadows"]:
        new_idf.add_shading_block(**block)
    for block in shadow_matching["zones"]:
        new_idf.add_block(**block)
    new_idf.translate_to_origin()
    new_idf.intersect_match()
    shadow = new_idf.getobject("SHADING:SITE:DETAILED", "PN1001_Bld1001_1_1")
    wall = new_idf.getobject(
        "BUILDINGSURFACE:DETAILED", "Block PN1001_Bld1003 Zone2 Storey 0 Wall 0003_1"
    )
    assert wall.Outside_Boundary_Condition == "adiabatic"
