#! /usr/bin/env python
import logging as log
import argparse
import pyxnat
import json
import tempfile
import os.path as op

import sys
dd = op.abspath(op.join(op.dirname(__file__), '..'))
sys.path.append(dd)
from bx import parse



if __name__=="__main__" :
    parser = parse.create_parser()
    args = parser.parse_args()
    if args.verbose:
        log.basicConfig(level=log.DEBUG)
    else:
        log.basicConfig(level=log.INFO)
    if not args.dest is None:
        dd = args.dest
    else:
        dd = json.load(open(args.config.name)).get('destination', None)
    if dd is None:
        dd = tempfile.gettempdir()
    log.info('Output folder: %s'%dd)
    x = pyxnat.Interface(config=args.config.name)

    parse.parse_args(args.command, args.args, x, dd, overwrite=args.overwrite)
