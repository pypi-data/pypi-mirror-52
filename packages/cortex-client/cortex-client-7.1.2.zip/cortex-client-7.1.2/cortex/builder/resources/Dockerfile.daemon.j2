# Auto-generated by the Cortex Python SDK

FROM {{base_image}}

WORKDIR /app

{% if conda_requirements %}
RUN conda install --yes python=3.6 \
 && conda config --add channels conda-forge \
 && conda install --yes flask gunicorn

COPY conda_requirements.txt .
RUN conda install --yes --file conda_requirements.txt
{% else %}
RUN pip install flask gunicorn
{% endif %}

RUN pip install "dill==0.2.8.2" "cortex-client=={{cortex_sdk_version}}"

{% if requirements %}
COPY requirements.txt .
RUN pip install -r requirements.txt
{% endif %}

{% if deploy_archive %}
COPY action.tar .
RUN tar xf action.tar --strip 1
{% endif %}

COPY action.py .

EXPOSE {{port}}

ENTRYPOINT ["gunicorn", "-b", "0.0.0.0:{{port}}", "-t", "60", "action:app"]
