var app=app||{};app.weatherData=function(){var e=null,t=null;return function(){e=$("#weather"),t=_.template($("#weather-template").html()),this.refresh=function(){var i=new XMLHttpRequest;i.responseType="json",i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var n=i.response;n&&e.html(t({day:n.results[0].weather_data[0],day1:n.results[0].weather_data[1],day2:n.results[0].weather_data[2]}))}},i.open("GET","/admin/baidu_weather/"),i.send()}}}(),app.mainWindow=function(){var e=null,t=null,i=function(){var i=$(window).height();if("function"==typeof e){var n=i-app.ui.header_height-app.ui.main_content_padding[0]-app.ui.main_content_padding[2]-app.ui.box_title;e(n)}if("function"==typeof t){var n=i-app.ui.header_height-app.ui.main_content_padding[0]-app.ui.main_content_padding[2];t(n)}};return new function(){$(window).resize(i),this.gridResize=function(t){e=t,i()},this.mainResize=function(e){t=e,i()},this.clear=function(){e=null,t=null}}}(),app.menus=function(){var e=function(t,i,n){for(var a=null,r=t.length-1;r>=0;r--){if(a=t[r],a.id===i)return a;if(a.depth!==n&&void 0!==a.childs){var s=e(a.childs,i,n);if(void 0!==s)return s}}};return new function(){this.getMenu=function(t,i){if(0===(i=i||1))return app.rootMenu;var n=app.rootMenu.childs;return e(n,t,i)}}}();var TopbarView=Backbone.View.extend({el:".topbar-nav-list",events:{"click li":"link"},initialize:function(){},render:function(){},link:function(e){e.preventDefault();var t=$(e.currentTarget),i=t.attr("data-menu"),n=t.attr("data-depth"),a=t.attr("data-main"),r=app.menus.getMenu(i,n),s=app.menus.getMenu(a,1);app.views.sidebarView.show(s.childs),app.views.menuView.setSelected(a),app.views.sidebarView.setSelected(i),app.views.productView.link(r)}}),MenuView=Backbone.View.extend({el:".header_nav",events:{"click li":"selected"},initialize:function(){this.$ifrInner=$("#ifrInner"),this.$lis=this.$("ul li"),this.render()},render:function(){var e=this.getSelected();return this.link(e),this},selected:function(e){e.preventDefault();var t=$(e.currentTarget),i=t.attr("data-menu");this.setSelected(i),this.link(i)},link:function(e){var t=app.menus.getMenu(e,1);null!==t&&(app.mainWindow.clear(),app.views.productView.hideNav(),void 0===t.childs?(app.views.sidebarView.hide(),app.views.productView.link(t)):(app.views.sidebarView.show(t.childs),app.views.productView.show(t)))},getSelected:function(){var e,t;return this.$lis.each(function(i,n){t=$(n),t.hasClass("selected")&&(e=t.attr("data-menu"))}),e},setSelected:function(e){this.$lis.each(function(t,i){$(i).attr("data-menu")!==e?$(i).removeClass("selected"):$(i).addClass("selected")})}}),SidebarView=Backbone.View.extend({el:".sidebar",events:{"click .sidebar-fold":"flod","click .sidebar-title":"navFlod","click .nav-item":"selected"},initialize:function(){this.$fold=this.$(".sidebar-fold"),this.$inner=this.$(".sidebar-inner"),this.$main=$(".viewFramework-body"),this.template=_.template($("#sidebar-template").html())},render:function(){return this},flod:function(e){this.$main.hasClass("viewFramework-sidebar-full")?(this.$main.removeClass("viewFramework-sidebar-full"),this.$main.addClass("viewFramework-sidebar-mini")):(this.$main.removeClass("viewFramework-sidebar-mini"),this.$main.addClass("viewFramework-sidebar-full")),window.hasOwnProperty("onMainWinResize")&&onMainWinResize()},navFlod:function(e){var t=$(e.currentTarget),i=t.parent(".sidebar-nav");i.hasClass("sidebar-nav-fold")?i.removeClass("sidebar-nav-fold"):i.addClass("sidebar-nav-fold")},selected:function(e){e.preventDefault();var t=$(e.currentTarget),i=t.attr("data-menu"),n=t.attr("data-depth");this.selectedMenuId(i,n)},selectedMenuId:function(e,t){var i=app.menus.getMenu(e,t);this.selectedMenuItem(i)},selectedMenuItem:function(e){var t=e.id;e.childs?this.link(e):(this.setSelected(t),this.linkUrl(e))},linkUrl:function(e){app.views.productView.hideNav(),app.views.productView.link(e)},link:function(e){this.setSelected(e.id),app.views.productView.showNav(e),app.views.productView.link(e)},show:function(e){this.$inner.html(this.template({e:e})),this.$main.hasClass("viewFramework-sidebar-none")&&(this.$main.removeClass("viewFramework-sidebar-none"),this.$main.addClass("viewFramework-sidebar-full"))},hide:function(){this.$main.removeClass("viewFramework-sidebar-full"),this.$main.removeClass("viewFramework-sidebar-mini"),this.$main.addClass("viewFramework-sidebar-none"),this.$inner.empty()},setSelected:function(e){this.$(".nav-item").each(function(t,i){$(i).attr("data-menu")!==e?$(i).removeClass("selected"):$(i).addClass("selected")})}}),ProductView=Backbone.View.extend({el:".viewFramework-product",events:{"click .product-item":"productSelect","click .product-nav-item":"selected","load #ifrInner":"ifrInnerLoaded"},initialize:function(){this.template=_.template($("#product-template").html()),this.navTemplate=_.template($("#product-nav-template").html()),this.$product=this.$(".product"),this.$mainNav=this.$(".product-nav-main-scene"),this.$subNav=this.$(".product-nav-sub-scene"),this.$ifrInner=this.$("#ifrInner"),this.iframe=document.getElementById("ifrInner")},selected:function(e){e.preventDefault();var t=$(e.currentTarget),i=t.attr("data-menu"),n=t.attr("data-depth"),a=app.menus.getMenu(i,n);this.link(a),this.setSelected(i)},setSelected:function(e){this.$(".product-nav-item").each(function(t,i){$(i).attr("data-menu")!==e?$(i).removeClass("active"):$(i).addClass("active")})},render:function(){},ifrInnerLoaded:function(){},productSelect:function(e){e.preventDefault();var t=$(e.currentTarget),i=t.attr("data-menu"),n=t.attr("data-depth");app.views.sidebarView.selectedMenuId(i,n)},link:function(e,t,i,n,a){var r=this.$product,s=t||e.menu_url_alias||e.menu_url,l=i||e.menu_target,n=n||e.is_cache,a=a||e.is_cross;"iframe"===l?s="/admin/iframe/?url="+s:"iframe_scroll"===l?s="/admin/iframe_scroll/?url="+s:"inner_iframe"===l?s="/admin/inner_iframe/?url="+s:"inner_iframe_scroll"===l&&(s="/admin/inner_iframe_scroll/?url="+s);var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(r.empty(),200==d.status?r.html(d.responseText):r.html(d.statusText))},d.open("GET",s),1==a&&(d.withCredentials=!0),d.send()},showNav:function(e){this.$mainNav.html(this.navTemplate({menuItem:e})),this.$el.hasClass("viewFramework-product-col-1")||this.$el.addClass("viewFramework-product-col-1")},hideNav:function(){this.$el.hasClass("viewFramework-product-col-1")&&this.$el.removeClass("viewFramework-product-col-1")},show:function(e){for(var t=[],i=e.childs,n=null,a=0,r=i.length;a<r;a++)if(void 0===i[a].childs)t.push(i[a]);else{n=i[a].childs;for(var s=0,l=n.length;s<l;s++)t.push(n[s])}var d=JSON.parse(e.remark);if(t.length<5)this.$product.html(this.template({e:e,lst:t,feature:d}));else{var t=_.filter(t,function(e){return 1==e.is_important});this.$product.html(this.template({e:e,lst:t,feature:d}))}this.$ifrInner.hide()},hide:function(){},full:function(){},large:function(){},small:function(){}}),AppView=Backbone.View.extend({el:"body",events:{},initialize:function(){},render:function(){return this}});