#!/bin/bash
#
# Copyright 2014 Hewlett-Packard Development Company, L.P.
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.

set -eu
set -o pipefail

if [ -f /etc/debian_version ] ;then
   exit 0
fi

mkdir -p $TMP_MOUNT_PATH/etc/apt/sources.list.d

# Add repo
cat >  $TMP_MOUNT_PATH/etc/apt/sources.list.d/puppetlabs.list  <<EOF

# Puppetlabs products
deb http://apt.puppetlabs.com trusty main
deb-src http://apt.puppetlabs.com trusty main

# Puppetlabs dependencies
deb http://apt.puppetlabs.com trusty dependencies
deb-src http://apt.puppetlabs.com trusty dependencies

# Puppetlabs devel (uncomment to activate)
# deb http://apt.puppetlabs.com trusty devel
# deb-src http://apt.puppetlabs.com trusty devel

EOF

# Add gpg key
cat > /tmp/plabs.key <<EOF
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1

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
ELpR2QyPlIySJ4a2psp4Hc2S43Xh
=YW3I
-----END PGP PUBLIC KEY BLOCK-----
EOF


apt-key add   /tmp/plabs.key
rm /tmp/plabs.key

apt-get update

